<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Matching Pairs Generator</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/html2canvas/1.4.1/html2canvas.min.js"></script>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-image: url('img/IMG_20250915_204654_099.jpg');
            background-size: cover;
            background-position: center;
            margin: 0;
            padding: 20px;
            text-align: center;
            color: #333;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background-color: rgba(255, 255, 255, 0.95);
            padding: 20px;
            border-radius: 15px;
            box-shadow: 0 0 20px rgba(0, 0, 0, 0.2);
        }
        h1 {
            color: #4b2e83;
            margin-bottom: 20px;
            font-size: 2.5rem;
        }
        .btn {
            background-color: #4b2e83;
            color: white;
            border: none;
            padding: 12px 20px;
            margin: 10px;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: all 0.3s;
        }
        .btn:hover {
            background-color: #3a2365;
            transform: scale(1.05);
        }
        .btn-reset {
            background-color: #ff6b6b;
        }
        .btn-reset:hover {
            background-color: #ee5253;
        }
        .btn-next {
            background-color: #10ac84;
            font-size: 18px;
            padding: 15px 30px;
        }
        .btn-next:hover {
            background-color: #0d916a;
        }
        .card-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 15px;
            margin: 20px 0;
        }
        .card {
            width: 150px;
            height: 150px;
            border: 3px solid #4b2e83;
            border-radius: 10px;
            overflow: hidden;
            cursor: pointer;
            transition: all 0.3s;
            position: relative;
            background-color: white;
        }
        .card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .card:hover {
            transform: scale(1.05);
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.2);
        }
        .card .delete-btn {
            position: absolute;
            top: 5px;
            right: 5px;
            background: red;
            color: white;
            border: none;
            border-radius: 50%;
            width: 25px;
            height: 25px;
            cursor: pointer;
            font-weight: bold;
            opacity: 0.8;
            transition: opacity 0.3s;
        }
        .card .delete-btn:hover {
            opacity: 1;
        }
        .pairs-container {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 20px;
            margin: 30px 0;
        }
        .pair {
            display: flex;
            flex-direction: column;
            align-items: center;
            min-width: 180px;
        }
        .pair-cards {
            display: flex;
            justify-content: center;
            gap: 10px;
            margin-bottom: 10px;
            min-height: 160px;
        }
        .pair-line {
            width: 100%;
            height: 3px;
            background-color: #4b2e83;
            margin: 10px 0;
        }
        #printable-cards {
            display: none;
        }
        #interactive-game {
            margin-top: 40px;
            padding-top: 20px;
            border-top: 2px dashed #4b2e83;
        }
        .matched {
            border: 3px solid #00cc66;
        }
        .section-title {
            color: #4b2e83;
            margin: 25px 0 15px;
            font-size: 1.8rem;
        }
        .compact-cards {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            max-width: 800px;
            margin: 0 auto;
        }
        .compact-card {
            width: 120px;
            height: 120px;
            border: 2px solid #4b2e83;
            border-radius: 8px;
            overflow: hidden;
        }
        .compact-card img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }
        .page {
            display: none;
        }
        .page.active {
            display: block;
        }
        .instructions {
            background-color: #f0f0f0;
            padding: 15px;
            border-radius: 8px;
            margin: 20px 0;
            text-align: left;
        }
        .pair-number {
            font-weight: bold;
            color: #4b2e83;
            margin-top: 5px;
        }
        #pdf-container {
            position: absolute;
            left: -9999px;
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>Matching Pairs Generator</h1>
        
        <div id="page-game" class="page active">
            <div id="interactive-game">
                <h2 class="section-title">Interactive Matching Game</h2>
                
                <div class="instructions">
                    <p><strong>Instructions:</strong> Remove any cards for absent players, then click "Generate Pairs" to create random pairs.</p>
                </div>
                
                <button class="btn" id="generate-pairs">Generate Pairs</button>
                <button class="btn btn-reset" id="reset-game">Reset Game</button>
                
                <div class="pairs-container" id="pairs-container"></div>
                
                <h3>Available Players (click X to remove)</h3>
                <div class="card-container" id="game-cards-container"></div>
                
                <button class="btn btn-next" id="next-to-print">Next → Printable Cards</button>
            </div>
        </div>
        
        <div id="page-print" class="page">
            <h2 class="section-title">Printable Cards</h2>
            <button class="btn" id="download-pdf">Download Printable Cards</button>
            <button class="btn btn-reset" id="back-to-game">← Back to Game</button>
            
            <div id="pdf-container">
                <h2>Matching Pairs Cards</h2>
                <div class="compact-cards" id="print-cards-container"></div>
            </div>
        </div>
    </div>

    <script>
        // Array with image paths
        const imagePaths = [
            'img/IMG_20250915_211102_070.jpg',
            'img/IMG_20250915_210951_839.jpg',
            'img/IMG_20250915_210819_511.jpg',
            'img/IMG_20250915_210725_695.jpg',
            'img/IMG_20250915_210720_511.jpg',
            'img/IMG_20250915_210636_917.jpg',
            'img/IMG_20250915_210546_214.jpg',
            'img/IMG_20250915_210456_392.jpg',
            'img/IMG_20250915_210419_415.jpg',
            'img/IMG_20250915_210343_967.jpg',
            'img/IMG_20250915_210251_903.jpg'
        ];

        // Current state
        let removedCards = [];
        let currentPairs = [];
        let pairsGenerated = false;

        // Initialize on page load
        document.addEventListener('DOMContentLoaded', function() {
            initializePrintableCards();
            initializeGameCards();
            
            // Set up event handlers
            document.getElementById('download-pdf').addEventListener('click', downloadPDF);
            document.getElementById('reset-game').addEventListener('click', resetGame);
            document.getElementById('generate-pairs').addEventListener('click', generatePairs);
            document.getElementById('next-to-print').addEventListener('click', function() {
                document.getElementById('page-game').classList.remove('active');
                document.getElementById('page-print').classList.add('active');
            });
            document.getElementById('back-to-game').addEventListener('click', function() {
                document.getElementById('page-print').classList.remove('active');
                document.getElementById('page-game').classList.add('active');
            });
        });

        // Initialize printable cards
        function initializePrintableCards() {
            const container = document.getElementById('print-cards-container');
            container.innerHTML = '';
            
            imagePaths.forEach((path, index) => {
                const card = document.createElement('div');
                card.className = 'compact-card';
                
                const img = document.createElement('img');
                img.src = path;
                img.alt = `Image ${index + 1}`;
                img.onerror = function() {
                    this.src = 'https://via.placeholder.com/120x120/4b2e83/ffffff?text=Image+' + (index+1);
                };
                
                card.appendChild(img);
                container.appendChild(card);
            });
        }

        // Initialize game cards
        function initializeGameCards() {
            const container = document.getElementById('game-cards-container');
            container.innerHTML = '';
            
            imagePaths.forEach((path, index) => {
                if (removedCards.includes(index)) return;
                
                const card = document.createElement('div');
                card.className = 'card';
                card.dataset.index = index;
                
                const img = document.createElement('img');
                img.src = path;
                img.alt = `Image ${index + 1}`;
                img.onerror = function() {
                    this.src = 'https://via.placeholder.com/150x150/4b2e83/ffffff?text=Image+' + (index+1);
                };
                
                const deleteBtn = document.createElement('button');
                deleteBtn.className = 'delete-btn';
                deleteBtn.innerHTML = 'X';
                deleteBtn.title = "Remove this player";
                deleteBtn.addEventListener('click', function(e) {
                    e.stopPropagation();
                    removeCard(index);
                });
                
                card.appendChild(img);
                card.appendChild(deleteBtn);
                
                container.appendChild(card);
            });
        }

        // Generate pairs
        function generatePairs() {
            generateRandomPairs();
            updatePairsDisplay();
            pairsGenerated = true;
        }

        // Generate random pairs
        function generateRandomPairs() {
            // Create a copy of available card indices
            let availableIndices = [];
            imagePaths.forEach((_, index) => {
                if (!removedCards.includes(index)) {
                    availableIndices.push(index);
                }
            });
            
            // Shuffle the array
            availableIndices = shuffleArray(availableIndices);
            
            // Create pairs
            currentPairs = [];
            
            // If odd number of cards, create one triple
            if (availableIndices.length % 2 !== 0) {
                if (availableIndices.length >= 3) {
                    currentPairs.push(availableIndices.splice(0, 3));
                }
            }
            
            // Create remaining pairs
            while (availableIndices.length >= 2) {
                currentPairs.push(availableIndices.splice(0, 2));
            }
        }

        // Update pairs display
        function updatePairsDisplay() {
            const container = document.getElementById('pairs-container');
            container.innerHTML = '';
            
            if (currentPairs.length === 0) {
                container.innerHTML = '<p>No pairs generated yet. Click "Generate Pairs" to create pairs.</p>';
                return;
            }
            
            currentPairs.forEach((pair, index) => {
                const pairElement = document.createElement('div');
                pairElement.className = 'pair';
                
                const pairCards = document.createElement('div');
                pairCards.className = 'pair-cards';
                
                pair.forEach(cardIndex => {
                    const card = document.createElement('div');
                    card.className = 'card matched';
                    
                    const img = document.createElement('img');
                    img.src = imagePaths[cardIndex];
                    img.alt = `Image ${cardIndex + 1}`;
                    img.onerror = function() {
                        this.src = 'https://via.placeholder.com/150x150/4b2e83/ffffff?text=Image+' + (cardIndex+1);
                    };
                    
                    card.appendChild(img);
                    pairCards.appendChild(card);
                });
                
                pairElement.appendChild(pairCards);
                
                const line = document.createElement('div');
                line.className = 'pair-line';
                pairElement.appendChild(line);
                
                // Add pair number
                const pairNumber = document.createElement('div');
                pairNumber.className = 'pair-number';
                pairNumber.textContent = `Pair ${index + 1}`;
                pairElement.appendChild(pairNumber);
                
                container.appendChild(pairElement);
            });
        }

        // Remove a card
        function removeCard(index) {
            if (!removedCards.includes(index)) {
                removedCards.push(index);
                
                // Remove pairs containing the removed card
                currentPairs = currentPairs.filter(pair => !pair.includes(index));
                
                // Reinitialize game cards
                initializeGameCards();
                
                // If pairs were already generated, regenerate them
                if (pairsGenerated) {
                    generatePairs();
                }
            }
        }

        // Reset the game
        function resetGame() {
            removedCards = [];
            currentPairs = [];
            pairsGenerated = false;
            
            initializeGameCards();
            updatePairsDisplay();
        }

        // Download PDF
        function downloadPDF() {
            const { jsPDF } = window.jspdf;
            
            // Create PDF document
            const doc = new jsPDF('p', 'mm', 'a4');
            const pdfWidth = doc.internal.pageSize.getWidth();
            const pdfHeight = doc.internal.pageSize.getHeight();
            
            // Use html2canvas to create image from the special PDF container
            html2canvas(document.getElementById('pdf-container')).then(canvas => {
                const imgData = canvas.toDataURL('image/jpeg', 1.0);
                
                // Calculate dimensions for image in PDF
                const imgWidth = pdfWidth - 20; // 10mm margins on each side
                const imgHeight = (canvas.height * imgWidth) / canvas.width;
                
                // Check if the content fits on one page
                if (imgHeight > pdfHeight - 30) {
                    // If not, split into multiple pages
                    let remainingHeight = imgHeight;
                    let position = 10;
                    let pageNum = 1;
                    
                    while (remainingHeight > 0) {
                        const pageHeight = Math.min(remainingHeight, pdfHeight - 20);
                        
                        // Add image part to current page
                        doc.addImage(imgData, 'JPEG', 10, 10 - (position - 10), imgWidth, imgHeight);
                        
                        // Add title to each page
                        doc.setFontSize(16);
                        doc.text('Matching Pairs Cards', pdfWidth / 2, 8, { align: 'center' });
                        
                        // If there's more content, add a new page
                        if (remainingHeight > pdfHeight - 20) {
                            doc.addPage();
                            position += pdfHeight - 20;
                            remainingHeight -= pdfHeight - 20;
                        } else {
                            remainingHeight = 0;
                        }
                    }
                } else {
                    // Add image to PDF
                    doc.addImage(imgData, 'JPEG', 10, 20, imgWidth, imgHeight);
                    
                    // Add title
                    doc.setFontSize(16);
                    doc.text('Matching Pairs Cards', pdfWidth / 2, 15, { align: 'center' });
                }
                
                // Save PDF
                doc.save('matching_pairs_cards.pdf');
            });
        }

        // Helper function to shuffle array
        function shuffleArray(array) {
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array;
        }
    </script>
</body>
</html>
